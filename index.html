<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jeopardy Pro - Guaranteed Audio</title>
    <style>
        :root {
            --bg-color: #020617;
            --card-bg: rgba(30, 41, 59, 0.8);
            --accent-color: #38bdf8;
            --gold: #fbbf24;
            --danger: #ef4444;
            --success: #22c55e;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at top right, #1e293b, #020617);
            color: #f8fafc; margin: 0; min-height: 100vh; overflow-x: hidden;
        }

        /* --- UI CONTROLS --- */
        #setup-page, #game-page, #winner-page { display: none; flex-direction: column; align-items: center; width: 100%; padding: 20px; box-sizing: border-box; }
        #setup-page { display: flex; height: 100vh; justify-content: center; }

        .music-ctrl {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            background: rgba(0,0,0,0.8); padding: 12px 24px; border-radius: 50px; 
            border: 2px solid var(--accent-color); cursor: pointer; color: white; font-weight: bold;
        }

        .scoreboard-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 20px; width: 100%; }
        .team-card { background: var(--card-bg); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); text-align: center; min-width: 140px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .team-score { font-size: 2rem; font-weight: 800; color: var(--gold); margin: 5px 0; }
        .manual-btn { background: #334155; border: none; color: white; cursor: pointer; padding: 5px 12px; border-radius: 4px; font-weight: bold; }

        /* THE GRID (4x10) */
        .game-board { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; 
            width: 98%; max-width: 1200px; margin-bottom: 50px;
        }
        .category-header { text-align: center; font-weight: 900; color: var(--accent-color); text-transform: uppercase; padding: 15px; background: rgba(15, 23, 42, 0.8); border-radius: 8px; border: 1px solid var(--accent-color); }
        
        .card { 
            background: var(--card-bg); height: 65px; display: flex; justify-content: center; 
            align-items: center; font-size: 1.4rem; font-weight: bold; border-radius: 8px; cursor: pointer; transition: 0.2s;
            border: 1px solid rgba(255,255,255,0.1); color: var(--gold);
        }
        .card:hover { transform: translateY(-3px); border-color: var(--gold); background: #1e293b; }
        .card.used { opacity: 0.2; background: #0f172a; cursor: pointer; }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #1e293b; padding: 3rem; border-radius: 24px; max-width: 800px; width: 90%; text-align: center; border: 3px solid var(--accent-color); box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        
        /* RANKING */
        .rank-card { background: rgba(30, 41, 59, 0.9); margin: 10px; padding: 30px; border-radius: 20px; width: 280px; text-align: center; border: 2px solid var(--gold); position: relative; }
        .rank-1 { transform: scale(1.1); border-width: 5px; box-shadow: 0 0 40px var(--gold); }

        .btn { padding: 15px 25px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.2s; }
        .firework { position: absolute; width: 6px; height: 6px; border-radius: 50%; animation: explode 2s infinite; pointer-events: none; }
        @keyframes explode { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(40); opacity: 0; } }
    </style>
</head>
<body>

<audio id="bg-music" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"></audio>
<audio id="sfx-click" src="https://actions.google.com/sounds/v1/communication/click_buttons.ogg"></audio>
<audio id="sfx-reveal" src="https://actions.google.com/sounds/v1/cartoon/clime_up_the_ladder.ogg"></audio>
<audio id="sfx-mystery" src="https://actions.google.com/sounds/v1/emergency/ambulance_siren_short.ogg"></audio>
<audio id="sfx-win" src="https://actions.google.com/sounds/v1/human_voices/applause.ogg"></audio>
<audio id="sfx-lose" src="https://actions.google.com/sounds/v1/foley/vacuum_reverse.ogg"></audio>
<audio id="sfx-cheer" src="https://actions.google.com/sounds/v1/human_voices/crowd_cheer.ogg"></audio>

<div class="music-ctrl" id="musicBtn" onclick="toggleMusic()">
    <span id="music-icon">üîá</span> <span id="music-status">Music Off</span>
</div>

<section id="setup-page">
    <div style="background: var(--card-bg); padding: 50px; border-radius: 30px; text-align: center; border: 2px solid var(--accent-color); width: 450px;">
        <h1 style="color:var(--gold); font-size: 3rem; margin:0 0 20px 0;">JEOPARDY</h1>
        <div id="team-inputs">
            <input type="text" style="width:100%; padding:15px; margin-bottom:15px; border-radius:8px; border:none; font-size:1rem;" value="Team 1">
        </div>
        <button class="btn" style="background:var(--accent-color); color:black; width:100%; margin-bottom:15px;" onclick="addTeamInput()">+ ADD TEAM</button>
        <button class="btn" style="background:var(--success); width:100%; color:white; font-size:1.2rem;" onclick="startGame()">START GAME</button>
    </div>
</section>

<section id="game-page">
    <div class="scoreboard-container" id="scoreboard"></div>
    <div class="game-board" id="board">
        <div class="category-header">AML</div><div class="category-header">ALL</div><div class="category-header">CML</div><div class="category-header">CLL</div>
    </div>
    <button class="btn" style="background:var(--danger); margin-top: 40px; color:white;" onclick="endGame()">FINISH GAME</button>
</section>

<section id="winner-page">
    <h1 style="color:var(--gold); font-size: 4rem; z-index: 10; text-shadow: 0 0 20px var(--gold);">FINAL RANKING</h1>
    <div id="rankings-display" style="display:flex; align-items:flex-end; gap:30px; z-index: 10; flex-wrap: wrap; justify-content: center;"></div>
    <button class="btn" style="background:var(--accent-color); margin-top:50px; z-index:10; color:black; padding: 20px 40px;" onclick="location.reload()">PLAY AGAIN</button>
</section>

<div id="qModal" class="modal">
    <div class="modal-content" id="modal-box">
        <div id="review-tag" style="display:none; color:var(--danger); font-weight:bold; font-size: 1.2rem; margin-bottom:15px;">üîç REVIEWING QUESTION</div>
        <div id="mystery-ui" style="display:none; color:var(--gold); font-size:2rem; font-weight:900; margin-bottom:15px; animation: pulse 1s infinite;">üö® DOUBLE OR NOTHING! üö®</div>
        <div id="display-q" style="font-size: 2.2rem; margin-bottom: 2rem; line-height: 1.2;"></div>
        <div id="display-a" style="display:none; color: var(--gold); font-size: 2.5rem; margin-bottom: 2rem; font-weight:800;"></div>
        
        <button class="btn" id="reveal-btn" style="background:var(--accent-color); color:black; font-size:1.5rem; padding: 20px 50px;" onclick="showAnswer()">REVEAL ANSWER</button>

        <div id="award-section" style="display:none; margin-top:25px; border-top: 2px solid #334155; padding-top: 25px;">
            <div id="award-grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px;"></div>
            <button class="btn" style="background:#64748b; color:white; margin-top:30px;" onclick="closeQ()">BACK TO BOARD</button>
        </div>
    </div>
</div>

<script>
    let teamNames = [];
    let teamScores = {};
    let mysteryIndex = -1;
    let currentVal = 0;
    let isReviewMode = false;
    let questionsUsed = 0;

    // --- REBUILT AUDIO HANDLER ---
    function playSfx(id) {
        const sound = document.getElementById(id);
        if (sound) {
            sound.pause(); // Stop existing
            sound.currentTime = 0; // Rewind
            const playPromise = sound.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => { console.log("SFX Blocked:", id); });
            }
        }
    }

    function toggleMusic() {
        const music = document.getElementById('bg-music');
        const icon = document.getElementById('music-icon');
        const status = document.getElementById('music-status');
        music.volume = 0.2;

        if (music.paused) {
            music.play().then(() => {
                icon.innerText = "üîä";
                status.innerText = "Music On";
            }).catch(e => alert("Please click anywhere on the page first to enable music."));
        } else {
            music.pause();
            icon.innerText = "üîá";
            status.innerText = "Music Off";
        }
    }

    function addTeamInput() {
        playSfx('sfx-click');
        const container = document.getElementById('team-inputs');
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.style = "width:100%; padding:15px; margin-bottom:15px; border-radius:8px; border:none; font-size:1rem;";
        inp.value = `Team ${container.children.length + 1}`;
        container.appendChild(inp);
    }

    function startGame() {
        // Unlock all audio on this user click
        ['sfx-click', 'sfx-reveal', 'sfx-mystery', 'sfx-win', 'sfx-lose', 'sfx-cheer'].forEach(id => {
            document.getElementById(id).play().then(() => {
                document.getElementById(id).pause();
                document.getElementById(id).currentTime = 0;
            });
        });

        const inputs = document.querySelectorAll('#team-inputs input');
        const scoreboard = document.getElementById('scoreboard');
        inputs.forEach(inp => {
            const name = inp.value;
            teamNames.push(name);
            teamScores[name] = 0;
            const div = document.createElement('div');
            div.className = 'team-card';
            div.innerHTML = `<div style="font-weight:bold; color:var(--accent-color)">${name}</div>
                             <div class="team-score" id="score-${name}">0</div>
                             <div style="display:flex; justify-content:center; gap:5px;">
                                <button class="manual-btn" onclick="modScore('${name}',-100)">-</button>
                                <button class="manual-btn" onclick="modScore('${name}',100)">+</button>
                             </div>`;
            scoreboard.appendChild(div);
        });

        // Generate Board (4x10)
        const board = document.getElementById('board');
        for (let row = 1; row <= 10; row++) {
            for (let cat = 0; cat < 4; cat++) {
                const val = row * 100;
                const card = document.createElement('div');
                card.className = 'card';
                card.innerText = val;
                card.onclick = () => openQ(card, `Category ${cat+1} Question for ${val}`, `The Correct Answer is ${val}`, val);
                board.appendChild(card);
            }
        }

        mysteryIndex = Math.floor(Math.random() * 30) + 5; // Avoid very top row
        document.getElementById('setup-page').style.display = 'none';
        document.getElementById('game-page').style.display = 'flex';
        playSfx('sfx-click');
    }

    function modScore(name, amt) {
        playSfx('sfx-click');
        teamScores[name] += amt;
        document.getElementById(`score-${name}`).innerText = teamScores[name];
    }

    function openQ(el, q, a, val) {
        isReviewMode = el.classList.contains('used');
        if(!isReviewMode) { 
            el.classList.add('used'); 
            questionsUsed++; 
        }
        
        currentVal = val;
        let isMystery = (Array.from(document.querySelectorAll('.card')).indexOf(el) === mysteryIndex && !isReviewMode);

        document.getElementById('display-q').innerText = q;
        document.getElementById('display-a').innerText = a;
        document.getElementById('display-a').style.display = 'none';
        document.getElementById('reveal-btn').style.display = 'inline-block';
        document.getElementById('award-section').style.display = 'none';
        document.getElementById('review-tag').style.display = isReviewMode ? 'block' : 'none';
        
        if(isMystery) {
            playSfx('sfx-mystery');
            document.getElementById('mystery-ui').style.display = 'block';
            document.getElementById('modal-box').style.borderColor = "var(--gold)";
        } else {
            playSfx('sfx-click');
            document.getElementById('mystery-ui').style.display = 'none';
            document.getElementById('modal-box').style.borderColor = "var(--accent-color)";
        }
        document.getElementById('qModal').style.display = 'flex';
    }

    function showAnswer() {
        playSfx('sfx-reveal');
        document.getElementById('display-a').style.display = 'block';
        document.getElementById('reveal-btn').style.display = 'none';
        document.getElementById('award-section').style.display = 'block';
        
        const grid = document.getElementById('award-grid');
        grid.innerHTML = '';

        if(!isReviewMode) {
            const isMysteryActive = (document.getElementById('mystery-ui').style.display === 'block');
            teamNames.forEach(name => {
                const awardBtn = document.createElement('button');
                awardBtn.className = 'btn';
                awardBtn.style.background = 'var(--success)';
                awardBtn.style.color = 'white';
                awardBtn.innerText = isMysteryActive ? `DOUBLE ${name}'s TOTAL` : `Award +${currentVal} to ${name}`;
                awardBtn.onclick = () => { 
                    if(isMysteryActive) teamScores[name] *= 2;
                    else teamScores[name] += currentVal;
                    document.getElementById(`score-${name}`).innerText = teamScores[name];
                    playSfx('sfx-win'); closeQ();
                };
                grid.appendChild(awardBtn);

                if(isMysteryActive) {
                    const loseBtn = document.createElement('button');
                    loseBtn.className = 'btn';
                    loseBtn.style.background = 'var(--danger)';
                    loseBtn.style.color = 'white';
                    loseBtn.innerText = `LOSE IT ALL (${name})`;
                    loseBtn.onclick = () => { 
                        teamScores[name] = 0; 
                        document.getElementById(`score-${name}`).innerText = 0;
                        playSfx('sfx-lose'); closeQ(); 
                    };
                    grid.appendChild(loseBtn);
                }
            });
        } else {
            grid.innerHTML = '<p style="grid-column: 1/-1; opacity:0.6; font-size:1.2rem;">Card already played. Scoring disabled.</p>';
        }
    }

    function closeQ() {
        document.getElementById('qModal').style.display = 'none';
        if(questionsUsed >= 40) endGame();
    }

    function endGame() {
        document.getElementById('game-page').style.display = 'none';
        document.getElementById('winner-page').style.display = 'flex';
        document.getElementById('bg-music').pause();
        playSfx('sfx-cheer');
        
        // Ranking Logic
        let sorted = Object.entries(teamScores).sort((a,b) => b[1] - a[1]);
        const display = document.getElementById('rankings-display');
        display.innerHTML = '';
        
        let topScore = sorted[0][1];
        let winners = sorted.filter(x => x[1] === topScore);
        
        winners.forEach(w => {
            display.innerHTML += `<div class="rank-card rank-1"><div style="font-size:3rem;">ü•á</div><h2>WINNER</h2><h1>${w[0]}</h1><p style="font-size:1.5rem;">${w[1]} pts</p></div>`;
        });

        let others = sorted.filter(x => x[1] < topScore);
        if(others[0]) display.innerHTML += `<div class="rank-card"><h2>ü•à 2nd</h2><h3>${others[0][0]}</h3><p>${others[0][1]} pts</p></div>`;
        if(others[1]) display.innerHTML += `<div class="rank-card"><h2>ü•â 3rd</h2><h3>${others[1][0]}</h3><p>${others[1][1]} pts</p></div>`;

        startFireworks();
    }

    function startFireworks() {
        for(let i=0; i<25; i++) {
            setTimeout(() => {
                const f = document.createElement('div');
                f.className = 'firework';
                f.style.left = Math.random() * 100 + 'vw';
                f.style.top = Math.random() * 80 + 'vh';
                f.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 60%)`;
                document.getElementById('winner-page').appendChild(f);
                setTimeout(() => f.remove(), 2000);
            }, i * 350);
        }
    }
</script>
</body>
</html>
